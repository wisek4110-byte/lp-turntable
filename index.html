<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>LP Turntable Player</title>

  <style>
    body {
      background: #f8f5ef;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      font-family: system-ui, sans-serif;
    }

    /* 전체 LP 영역 - 반응형 */
    .lp-wrapper {
      position: relative;
      width: min(80vw, 400px);
      aspect-ratio: 1 / 1;
      cursor: pointer;
    }

    /* 커버 뒤, LP 앞에 놓이는 고정 배경 레이어 */
    .lp-bg {
      position: absolute;
      inset: 0;
      background: #ffffff;
      border-radius: 8px;
      z-index: 1;
      pointer-events: none;
    }

    /* 아래 레이어: 이전 커버 */
    .lp-cover-old {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
      border-radius: 8px;
      z-index: 2;
      pointer-events: none;
    }

    /* 위 레이어: 새 커버 (페이드 인) */
    .lp-cover-new {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
      border-radius: 8px;
      z-index: 3;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.6s ease-in-out; /* 페이드 속도 */
    }

    /* LP판 래퍼 (슬라이드) */
    .lp-disc-wrapper {
      position: absolute;
      width: 87.5%;
      height: 87.5%;
      top: 10%;
      left: 12.25%;
      z-index: 0;
      transform: translateX(-14%);
      transition: transform 0.6s ease-in-out;  /* ← 더 빠르게 */
    }

    .lp-wrapper.playing .lp-disc-wrapper {
      transform: translateX(66%);
    }

    /* LP 원판 */
    .lp-disc {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      animation: spin 3.2s linear infinite;
      animation-play-state: paused;
    }

    .lp-wrapper.playing .lp-disc {
      animation-play-state: running;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }

    /* 유튜브 iframe 숨김 */
    #player {
      position: absolute;
      width: 0;
      height: 0;
      left: -9999px;
      top: -9999px;
      border: none;
    }
  </style>
</head>

<body>

  <div class="lp-wrapper" id="lp-area">
    <div class="lp-bg"></div>

    <!-- 아래: 이전 커버 -->
    <div class="lp-cover-old"></div>

    <!-- 위: 새 커버 (페이드 인) -->
    <div class="lp-cover-new"></div>

    <!-- LP 디스크 -->
    <div class="lp-disc-wrapper">
      <div class="lp-disc"></div>
    </div>

    <!-- 유튜브 플레이어 -->
    <div id="player"></div>
  </div>

  <script>
    // YouTube IFrame API 로드
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);

    // 플레이리스트
    var playlist = [
      "kAAcl3nIe24",
      "9uxYuIpvsjw",
      "iv9rmTEaECw"
    ];

    // 곡별 커버 / LP 이미지
    var coverImages = [
      "lp-cover1.png",
      "lp-cover2.png",
      "lp-cover3.png"
    ];

    var discImages = [
      "lp-image1.png",
      "lp-image2.png",
      "lp-image3.png"
    ];

    var currentIndex = 0;
    var player;
    var audioEnabled = false;
    var startedOnce = false;

    var lpArea   = document.getElementById("lp-area");
    var coverOld = document.querySelector(".lp-cover-old");
    var coverNew = document.querySelector(".lp-cover-new");
    var lpDisc   = document.querySelector(".lp-disc");

    // 이전 커버/디스크 이미지 URL 저장용
    var lastCoverUrl = null;
    var lastDiscUrl  = null;

    var clickTimer   = null;
    var CLICK_DELAY  = 250;

    // 현재 트랙에 맞게 비주얼 업데이트
    function updateVisualsForCurrentTrack() {
      var newCoverUrl = 'url("' + coverImages[currentIndex] + '")';
      var newDiscUrl  = 'url("' + discImages[currentIndex] + '")';

      // 첫 호출일 때: 바로 세팅하고 종료 (페이드 X)
      if (!lastCoverUrl) {
        lastCoverUrl = newCoverUrl;
        lastDiscUrl  = newDiscUrl;

        coverOld.style.backgroundImage = lastCoverUrl;
        coverNew.style.backgroundImage = lastCoverUrl;
        coverNew.style.opacity = 1;

        lpDisc.style.backgroundImage = lastDiscUrl;
        return;
      }

      // 아래 레이어엔 이전 커버 유지
      coverOld.style.backgroundImage = lastCoverUrl;

      // 새 커버 준비 (투명 상태)
      coverNew.style.opacity = 0;
      coverNew.style.backgroundImage = newCoverUrl;

      // 약간의 딜레이 후 페이드 인
      setTimeout(function () {
        coverNew.style.opacity = 1;
      }, 20); // 1 프레임 정도 후에 실행

      // LP 레이블은 커버보다 살짝 늦게 변경
      setTimeout(function () {
        lpDisc.style.backgroundImage = newDiscUrl;
        // 이제 이 트랙이 "이전 커버"가 됨
        lastCoverUrl = newCoverUrl;
        lastDiscUrl  = newDiscUrl;
      }, 400); // 페이드 중간쯤 바뀌는 느낌
    }

    // YouTube API Ready
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '0',
        width: '0',
        videoId: playlist[0],
        playerVars: { playsinline: 1, autoplay: 0, controls: 0, rel: 0 },
        events: { onReady: onPlayerReady, onStateChange: onPlayerStateChange }
      });
    }

    function onPlayerReady() {
      // 첫 트랙 이미지 세팅
      updateVisualsForCurrentTrack();

      // 단일 클릭: 재생/일시정지
      lpArea.addEventListener("click", function () {
        if (!audioEnabled) audioEnabled = true;
        if (clickTimer) return;

        clickTimer = setTimeout(function () {
          clickTimer = null;
          handleSingleClick();
        }, CLICK_DELAY);
      });

      // 더블클릭: 다음 곡
      lpArea.addEventListener("dblclick", function () {
        if (clickTimer) {
          clearTimeout(clickTimer);
          clickTimer = null;
        }
        handleDoubleClick();
      });
    }

    // 단일 클릭: 재생/일시정지
    function handleSingleClick() {
      if (!startedOnce) {
        playCurrent();
        return;
      }

      var state = player.getPlayerState();

      if (state === YT.PlayerState.PLAYING) {
        player.pauseVideo();
        lpArea.classList.remove("playing");
      } else {
        player.playVideo();
        lpArea.classList.add("playing");
      }
    }

    // 더블클릭: 다음 곡
    function handleDoubleClick() {
      if (!startedOnce) {
        currentIndex = (currentIndex + 1) % playlist.length;
        playCurrent();
        return;
      }
      nextTrack();
    }

    function playCurrent() {
      startedOnce = true;
      updateVisualsForCurrentTrack();
      player.loadVideoById(playlist[currentIndex]);
      player.playVideo();
      lpArea.classList.add("playing");
    }

    function nextTrack() {
      currentIndex = (currentIndex + 1) % playlist.length;
      updateVisualsForCurrentTrack();
      player.loadVideoById(playlist[currentIndex]);
      player.playVideo();
      lpArea.classList.add("playing");
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        lpArea.classList.add("playing");
      }
      if (event.data === YT.PlayerState.ENDED) {
        nextTrack();
      }
      if (event.data === YT.PlayerState.PAUSED) {
        lpArea.classList.remove("playing");
      }
    }
  </script>
</body>
</html>
