<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>LP Cover Slide + Rotate</title>

  <style>
    body {
      background: #f8f5ef; /* 옅은 베이지. 완전 흰색 원하면 #ffffff 로 변경 */
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      font-family: system-ui, sans-serif;
    }

    /* 전체 LP 영역 - 반응형 */
    .lp-wrapper {
      position: relative;
      width: min(80vw, 400px); /* 화면 크기에 따라 자동 줄어듦, 최대 400px */
      aspect-ratio: 1 / 1;     /* 정사각형 유지 */
      cursor: pointer;
    }

    /* LP 커버 이미지 */
    .lp-cover {
      position: absolute;
      inset: 0; /* top/right/bottom/left = 0 */
      /* 기본 이미지는 JS에서 설정 (곡마다 변경용) */
      background-size: cover;
      background-position: center;
      border-radius: 8px;
      z-index: 2;
      pointer-events: none;
      opacity: 1;
      transition: opacity 0.5s ease; /* 서서히 나타나기용 */
    }

    /* LP판을 감싸는 래퍼: "옆으로 슬라이드"만 담당 */
    .lp-disc-wrapper {
      position: absolute;
      width: 87.5%;   /* 350/400 */
      height: 87.5%;
      top: 10%;       /* 40/400 */
      left: 12.25%;   /* 49/400 */
      z-index: 1;

      /* 기본: 커버 안쪽에 숨어 있음 (비율 기준으로 조정) */
      transform: translateX(-14%);
      transition: transform 0.6s ease;
    }

    /* 재생 중일 때만 LP가 밖으로 튀어나옴 */
    .lp-wrapper.playing .lp-disc-wrapper {
      transform: translateX(66%);
    }

    /* 실제 회전하는 LP 원판 */
    .lp-disc {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      /* 기본 이미지는 JS에서 설정 (곡마다 변경용) */
      background-size: cover;
      background-position: center;

      animation: spin 3.2s linear infinite;
      animation-play-state: paused;  /* 기본은 정지 */
    }

    /* 재생 중일 때만 회전 시작 */
    .lp-wrapper.playing .lp-disc {
      animation-play-state: running;
    }

    /* 회전 애니메이션 (회전만! 위치 X) */
    @keyframes spin {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }

    /* 유튜브 iframe 숨김 */
    #player {
      position: absolute;
      width: 0;
      height: 0;
      left: -9999px;
      top: -9999px;
      border: none;
    }
  </style>
</head>

<body>

  <div class="lp-wrapper" id="lp-area">
    <div class="lp-cover"></div>

    <!-- 슬라이드 + 회전 LP -->
    <div class="lp-disc-wrapper">
      <div class="lp-disc"></div>
    </div>

    <!-- 유튜브 플레이어 (화면에는 안 보임) -->
    <div id="player"></div>
  </div>

  <script>
    // 1. IFrame Player API를 비동기로 로드
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // 2. 플레이리스트
    var playlist = [
      "kAAcl3nIe24", // 1번 곡
      "9uxYuIpvsjw", // 2번 곡
      "iv9rmTEaECw"  // 3번 곡
    ];

    // 곡별 커버 이미지 / LP 이미지
    var coverImages = [
      "lp-cover1.png",
      "lp-cover2.png",
      "lp-cover3.png"
    ];

    var discImages = [
      "lp-image1.png",
      "lp-image2.png",
      "lp-image3.png"
    ];

    var currentIndex   = 0;      // 현재 곡 인덱스
    var player;
    var audioEnabled   = false;  // 사용자 상호작용(첫 클릭) 여부
    var startedOnce    = false;  // 한 번이라도 재생된 적 있는지
    var lpArea         = document.getElementById('lp-area');
    var lpCover        = document.querySelector('.lp-cover');
    var lpDisc         = document.querySelector('.lp-disc');

    // 클릭/더블클릭 구분용
    var clickTimer     = null;
    var CLICK_DELAY    = 250;    // ms

    // 현재 인덱스에 맞춰 커버 & LP 이미지 변경
    // - 커버: 살짝 사라졌다가 새 이미지로 페이드 인
    // - 디스크: 커버보다 조금 늦게 변경
    function updateVisualsForCurrentTrack() {
      if (!lpCover || !lpDisc) return;

      var coverUrl = 'url("' + coverImages[currentIndex] + '")';
      var discUrl  = 'url("' + discImages[currentIndex] + '")';

      // 커버: 서서히 나타나기
      lpCover.style.opacity = 0; // 먼저 살짝 숨김
      setTimeout(function () {
        lpCover.style.backgroundImage = coverUrl;
        lpCover.style.opacity = 1; // transition으로 부드럽게 등장
      }, 300); // 약간의 딜레이 후 이미지 교체 + 페이드 인

      // LP 디스크: 커버보다 조금 늦게 이미지 변경
      setTimeout(function () {
        lpDisc.style.backgroundImage = discUrl;
      }, 350); // 커버 바뀐 후 약간 뒤에 변경되는 느낌
    }

    // 3. API 코드가 로드되면 이 함수가 자동 호출됨
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '0',
        width: '0',
        videoId: playlist[0],  // 초기 로드용 (실제 재생은 클릭에서 제어)
        playerVars: {
          'playsinline': 1,
          'autoplay': 0,
          'controls': 0,
          'rel': 0
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    // 4. 플레이어 준비 완료 시
    function onPlayerReady(event) {
      // 첫 로드시 0번 곡 이미지 세팅
      updateVisualsForCurrentTrack();

      // 단일 클릭
      lpArea.addEventListener('click', function () {
        if (!audioEnabled) {
          audioEnabled = true; // 브라우저 오디오 정책용
        }
        if (!player) return;

        // 더블클릭 대기 중이면 여기선 아무 것도 안 함
        if (clickTimer) return;

        clickTimer = setTimeout(function () {
          clickTimer = null;
          handleSingleClick();
        }, CLICK_DELAY);
      });

      // 더블클릭
      lpArea.addEventListener('dblclick', function () {
        if (!player) return;

        // 예정된 단일 클릭 동작 취소
        if (clickTimer) {
          clearTimeout(clickTimer);
          clickTimer = null;
        }
        handleDoubleClick();
      });
    }

    // 단일 클릭: 재생/일시정지 토글
    function handleSingleClick() {
      if (!player) return;

      // 아직 안 틀어봤으면 현재 곡 재생
      if (!startedOnce) {
        playCurrent();
        return;
      }

      var state = player.getPlayerState();

      if (state === YT.PlayerState.PLAYING) {
        // 재생 중 → 일시정지 + LP 넣기
        player.pauseVideo();
        lpArea.classList.remove('playing');
      } else {
        // 일시정지/끝남/대기 상태 → 다시 재생 + LP 빼기
        player.playVideo();
        lpArea.classList.add('playing');
      }
    }

    // 더블클릭: 다음 곡으로 넘기기
    function handleDoubleClick() {
      if (!player) return;

      // 한 번도 재생한 적 없다면, 다음 곡으로 인덱스 옮기고 재생 시작
      if (!startedOnce) {
        currentIndex = (currentIndex + 1) % playlist.length;
        playCurrent();
        return;
      }

      // 이미 재생 경험이 있으면 그냥 다음 트랙
      nextTrack();
    }

    // 현재 인덱스 곡 재생 + LP 애니메이션 ON
    function playCurrent() {
      if (!player) return;
      startedOnce = true;
      updateVisualsForCurrentTrack();
      player.loadVideoById(playlist[currentIndex]);
      player.playVideo();
      lpArea.classList.add('playing');
    }

    // 다음 트랙으로 이동 (마지막 다음 → 첫 곡으로)
    function nextTrack() {
      if (!player) return;
      currentIndex = (currentIndex + 1) % playlist.length; // 마지막 다음 → 0번
      updateVisualsForCurrentTrack();
      player.loadVideoById(playlist[currentIndex]);
      player.playVideo();
      lpArea.classList.add('playing');
    }

    // 5. 플레이어 상태 변경 감지
    function onPlayerStateChange(event) {
      // 재생 시작되면 LP 나와서 회전
      if (event.data === YT.PlayerState.PLAYING) {
        lpArea.classList.add('playing');
      }

      // 곡이 끝나면 자동으로 다음 곡 재생
      if (event.data === YT.PlayerState.ENDED) {
        nextTrack();
      }

      // 일시정지 시에는 LP 넣기
      if (event.data === YT.PlayerState.PAUSED) {
        lpArea.classList.remove('playing');
      }
    }
  </script>
</body>
</html>

