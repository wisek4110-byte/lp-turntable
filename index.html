<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>LP Cover Slide + Rotate</title>

  <style>
    body {
      background: #f8f5ef; /* 옅은 베이지. 완전 흰색 원하면 #ffffff 로 변경 */
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      font-family: system-ui, sans-serif;
    }

    /* 전체 LP 영역 */
    .lp-wrapper {
      position: relative;
      width: 400px;   /* 커버 크기 (필요하면 조정) */
      height: 400px;
      cursor: pointer;
      /* hover 때 transform 제거해서 '움찔거림' 방지 */
    }

    /* LP 커버 이미지 */
    .lp-cover {
      position: absolute;
      inset: 0; /* top/right/bottom/left = 0 */
      background-image: url("lp-cover.png");  /* 사용자 커버 이미지 */
      background-size: cover;
      background-position: center;
      border-radius: 8px;
      z-index: 2;
      pointer-events: none;
    }

    /* LP판을 감싸는 래퍼: "옆으로 슬라이드"만 담당 */
    .lp-disc-wrapper {
      position: absolute;
      width: 350px;
      height: 350px;
      top: 40px;   /* 세로 가운데 정렬 느낌 */
      left: 49px;
      z-index: 1;

      /* 기본: 커버 안쪽에 숨어 있음 */
      transform: translateX(-50px);
      transition: transform 0.6s ease;
    }

    /* 재생 중일 때만 LP가 밖으로 튀어나옴 */
    .lp-wrapper.playing .lp-disc-wrapper {
      transform: translateX(230px);
    }

    /* 실제 회전하는 LP 원판 */
    .lp-disc {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-image: url("lp-image.png");  /* 사용자 LP 이미지 */
      background-size: cover;
      background-position: center;

      animation: spin 3.2s linear infinite;
      animation-play-state: paused;  /* 기본은 정지 */
    }

    /* 재생 중일 때만 회전 시작 */
    .lp-wrapper.playing .lp-disc {
      animation-play-state: running;
    }

    /* 회전 애니메이션 (회전만! 위치 X) */
    @keyframes spin {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }

    /* 유튜브 iframe 숨김 */
    #player {
      position: absolute;
      width: 0;
      height: 0;
      left: -9999px;
      top: -9999px;
      border: none;
    }
  </style>
</head>

<body>

  <div class="lp-wrapper" id="lp-area">
    <div class="lp-cover"></div>

    <!-- 슬라이드 + 회전 LP -->
    <div class="lp-disc-wrapper">
      <div class="lp-disc"></div>
    </div>

    <!-- 유튜브 플레이어 (화면에는 안 보임) -->
    <div id="player"></div>
  </div>

  <script>
    // 1. IFrame Player API를 비동기로 로드
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // 2. 플레이리스트: 여기 영상 ID들을 넣으면 됨
    //    예) https://www.youtube.com/watch?v=kAAcl3nIe24 → "kAAcl3nIe24"
    var playlist = [
      "kAAcl3nIe24", // 1번 곡
      // "VIDEO_ID_2", // 2번 곡 (필요하면 주석 해제하고 추가)
      // "VIDEO_ID_3"
    ];

    var currentIndex = 0;     // 현재 곡 인덱스
    var player;
    var audioEnabled = false; // 사용자 상호작용(클릭) 여부
    var startedOnce = false;  // 첫 재생 여부
    var lpArea = document.getElementById('lp-area');

    // 3. API 코드가 로드되면 이 함수가 자동 호출됨
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '0',
        width: '0',
        videoId: playlist[0],  // 초기 로드용 (실제 재생은 클릭에서 제어)
        playerVars: {
          'playsinline': 1,
          'autoplay': 0,
          'controls': 0,
          'rel': 0
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    // 4. 플레이어 준비 완료 시
    function onPlayerReady(event) {
      lpArea.addEventListener('click', function () {
        // 첫 사용자 상호작용 기록 (사운드 허용용)
        if (!audioEnabled) {
          audioEnabled = true;
        }
        if (!player) return;

        // 아직 한 번도 안 틀었으면: 현재 인덱스(0번) 재생
        if (!startedOnce) {
          startedOnce = true;
          playCurrent();
          return;
        }

        // 이미 한 번이라도 재생한 적이 있으면:
        // 클릭할 때마다 다음 곡으로 넘어감
        nextTrack();
      });
    }

    // 현재 인덱스 곡 재생 + LP 애니메이션 ON
    function playCurrent() {
      if (!player) return;
      player.loadVideoById(playlist[currentIndex]);
      player.playVideo();
      lpArea.classList.add('playing');
    }

    // 다음 트랙으로 이동 (마지막 다음 → 첫 곡으로)
    function nextTrack() {
      if (!player) return;
      currentIndex = (currentIndex + 1) % playlist.length; // 마지막 다음 → 0번
      player.loadVideoById(playlist[currentIndex]);
      player.playVideo();
      lpArea.classList.add('playing');
    }

    // 5. 플레이어 상태 변경 감지
    function onPlayerStateChange(event) {
      // 재생 시작되면 LP 나와서 회전
      if (event.data === YT.PlayerState.PLAYING) {
        lpArea.classList.add('playing');
      }

      // 곡이 끝나면 LP가 자동으로 들어가도록
      if (event.data === YT.PlayerState.ENDED) {
        lpArea.classList.remove('playing');
        // 여기서는 자동으로 다음 곡 재생하지 않음
        // → 사용자가 다시 클릭하면 nextTrack() 호출되면서 다음 곡 재생
      }

      // 일시정지 시에도 LP 멈추고 들어가고 싶다면 아래 주석 해제
      /*
      if (event.data === YT.PlayerState.PAUSED) {
        lpArea.classList.remove('playing');
      }
      */
    }
  </script>
</body>
</html>
