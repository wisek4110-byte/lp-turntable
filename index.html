<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>LP Turntable Player</title>

  <style>
    body {
      background: #f8f5ef;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      font-family: system-ui, sans-serif;
    }

    /* 전체 LP 영역 - 반응형 */
    .lp-wrapper {
      position: relative;
      width: min(80vw, 400px);
      aspect-ratio: 1 / 1;
      cursor: pointer;
    }

    /* 중간 배경 레이어 */
    .lp-bg {
      position: absolute;
      inset: 0;
      background: #ffffff;
      border-radius: 8px;
      z-index: 1;
      pointer-events: none;
    }

    /* 아래 레이어: 이전 커버 */
    .lp-cover-old {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
      border-radius: 8px;
      z-index: 2;
      pointer-events: none;
    }

    /* 위 레이어: 새 커버 (페이드 인) */
    .lp-cover-new {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
      border-radius: 8px;
      z-index: 3;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.8s ease-in-out;
    }

    /* LP판 */
    .lp-disc-wrapper {
      position: absolute;
      width: 87.5%;
      height: 87.5%;
      top: 10%;
      left: 12.25%;
      z-index: 0;
      transform: translateX(-14%);
      transition: transform 1s ease-in-out;
    }

    .lp-wrapper.playing .lp-disc-wrapper {
      transform: translateX(66%);
    }

    .lp-disc {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-size: cover;
      background-position: center;

      animation: spin 3.2s linear infinite;
      animation-play-state: paused;
    }

    .lp-wrapper.playing .lp-disc {
      animation-play-state: running;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }

    #player {
      position: absolute;
      width: 0;
      height: 0;
      left: -9999px;
      top: -9999px;
      border: none;
    }
  </style>
</head>

<body>

  <div class="lp-wrapper" id="lp-area">

    <div class="lp-bg"></div>

    <!-- 아래: 이전 커버 -->
    <div class="lp-cover-old"></div>

    <!-- 위: 새 커버 (페이드 인) -->
    <div class="lp-cover-new"></div>

    <!-- LP 디스크 -->
    <div class="lp-disc-wrapper">
      <div class="lp-disc"></div>
    </div>

    <div id="player"></div>
  </div>

  <script>
    /* YouTube API 로드 */
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);

    /* 플레이리스트 */
    var playlist = [
      "kAAcl3nIe24",
      "9uxYuIpvsjw",
      "iv9rmTEaECw"
    ];

    /* 커버/디스크 이미지 */
    var coverImages = [
      "lp-cover1.png",
      "lp-cover2.png",
      "lp-cover3.png"
    ];

    var discImages = [
      "lp-image1.png",
      "lp-image2.png",
      "lp-image3.png"
    ];

    var currentIndex = 0;
    var player;
    var audioEnabled = false;
    var startedOnce = false;

    var lpArea  = document.getElementById("lp-area");
    var coverOld = document.querySelector(".lp-cover-old");
    var coverNew = document.querySelector(".lp-cover-new");
    var lpDisc   = document.querySelector(".lp-disc");

    var clickTimer = null;
    var CLICK_DELAY = 250;

    /* 커버 전환 애니메이션 */
    function updateVisualsForCurrentTrack() {
      var coverUrl = 'url("' + coverImages[currentIndex] + '")';
      var discUrl  = 'url("' + discImages[currentIndex] + '")';

      /* 현재 커버를 아래 레이어로 복사 */
      coverOld.style.backgroundImage = coverUrl;

      /* 새 커버 설정 (투명한 상태) */
      coverNew.style.opacity = 0;
      coverNew.style.backgroundImage = coverUrl;

      /* 딜레이 후 천천히 페이드 인 */
      setTimeout(() => {
        coverNew.style.opacity = 1;
      }, 50);

      /* LP 디스크 라벨은 나중에 변경 */
      setTimeout(() => {
        lpDisc.style.backgroundImage = discUrl;
      }, 600);
    }

    /* YouTube Player Ready */
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '0',
        width: '0',
        videoId: playlist[0],
        playerVars: { playsinline: 1, autoplay: 0, controls: 0, rel: 0 },
        events: { onReady: onPlayerReady, onStateChange: onPlayerStateChange }
      });
    }

    function onPlayerReady() {
      updateVisualsForCurrentTrack();

      lpArea.addEventListener("click", () => {
        if (!audioEnabled) audioEnabled = true;
        if (clickTimer) return;

        clickTimer = setTimeout(() => {
          clickTimer = null;
          handleSingleClick();
        }, CLICK_DELAY);
      });

      lpArea.addEventListener("dblclick", () => {
        if (clickTimer) {
          clearTimeout(clickTimer);
          clickTimer = null;
        }
        handleDoubleClick();
      });
    }

    /* 단일 클릭: 재생/일시정지 */
    function handleSingleClick() {
      if (!startedOnce) return playCurrent();

      var state = player.getPlayerState();

      if (state === YT.PlayerState.PLAYING) {
        player.pauseVideo();
        lpArea.classList.remove("playing");
      } else {
        player.playVideo();
        lpArea.classList.add("playing");
      }
    }

    /* 더블클릭: 다음곡 */
    function handleDoubleClick() {
      if (!startedOnce) {
        currentIndex = (currentIndex + 1) % playlist.length;
        playCurrent();
        return;
      }
      nextTrack();
    }

    function playCurrent() {
      startedOnce = true;
      updateVisualsForCurrentTrack();
      player.loadVideoById(playlist[currentIndex]);
      player.playVideo();
      lpArea.classList.add("playing");
    }

    function nextTrack() {
      currentIndex = (currentIndex + 1) % playlist.length;
      updateVisualsForCurrentTrack();
      player.loadVideoById(playlist[currentIndex]);
      player.playVideo();
      lpArea.classList.add("playing");
    }

    /* 유튜브 상태 */
    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        lpArea.classList.add("playing");
      }
      if (event.data === YT.PlayerState.ENDED) {
        nextTrack();
      }
      if (event.data === YT.PlayerState.PAUSED) {
        lpArea.classList.remove("playing");
      }
    }
  </script>
</body>
</html>
